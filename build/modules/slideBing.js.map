{
  "version": 3,
  "sources": ["../../src/modules/slideBing.ts"],
  "sourcesContent": ["import axios from \"axios\";\nimport { GlobalHelper } from \"./global-helper\"\n\ninterface BingJSONImage{\n\turl: string,\n\ttitle: string,\n\tcopyright: string,\n\tstartdate: string,\n\tany: string|boolean|number\n}\n\ninterface BingJSONImageList{\n\timages: BingJSONImage[],\n\tany: any\n}\n\nexport interface BingPicture{\n\tbingurl: string,\n\tpath: string,\n\turl: string,\n\tinfo1: string,\n\tinfo2: string,\n\tinfo3: string,\n\tdate: Date\n}\n\nexport interface BingPictureListUpdateResult{\n\tsuccess: boolean;\n\tpicturecount: number;\n}\n\nconst BingUrl = \"https://www.bing.com/HPImageArchive.aspx?format=js&idx=0&n=10&mkt=de-DE\";\nlet BingPictureList: BingPicture[];\nlet CurrentImage: BingPicture;\n\nexport async function getPicture(Helper: GlobalHelper): Promise<BingPicture | null > {\n\ttry{\n\t\tif (BingPictureList.length === 0){\n\t\t\tawait updatePictureList(Helper);\n\t\t}\n\t\tif (BingPictureList.length !== 0){\n\t\t\tif (!CurrentImage){\n\t\t\t\tCurrentImage = BingPictureList[0];\n\t\t\t} else {\n\t\t\t\tif (BingPictureList.indexOf(CurrentImage) === BingPictureList.length - 1){\n\t\t\t\t\tCurrentImage = BingPictureList[0];\n\t\t\t\t} else {\n\t\t\t\t\tCurrentImage = BingPictureList[BingPictureList.indexOf(CurrentImage) + 1];\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn CurrentImage;\n\t\t}\n\t\treturn null;\n\t}catch (err){\n\t\tHelper.ReportingError(err as Error, \"Unknown Error\", \"Bing\", \"getPicture\");\n\t\treturn null;\n\t}\n}\n\nexport async function updatePictureList(Helper: GlobalHelper): Promise<BingPictureListUpdateResult> {\n\t// Getting List from Bing.com\n\tlet WebResult: axios.AxiosResponse;\n\ttry{\n\t\tBingPictureList = [];\n\t\tWebResult = await axios.get(BingUrl);\n\t\tHelper.ReportingInfo(\"Debug\", \"Bing\", \"Picture list received\", { JSON: JSON.stringify(WebResult.data) });\n\t} catch (err) {\n\t\tHelper.ReportingError(err as Error, \"Unknown Error\", \"Bing\", \"updatePictureList/Retrieve\");\n\t\treturn { success: false, picturecount: 0};\n\t}\n\tif (WebResult.data && WebResult.data != \"\" ){\n\t\ttry{\n\t\t\t((WebResult.data) as BingJSONImageList).images.forEach(Image =>{\n\t\t\t\tconst ImageDetails = Image.copyright.match(/(.*)\\s\\(\u00A9\\s(.*)\\)/);\n\t\t\t\tlet ImageDescription = \"\";\n\t\t\t\tlet ImageCopyright = \"\"\n\t\t\t\tif (ImageDetails){\n\t\t\t\t\tImageDescription = ImageDetails[1];\n\t\t\t\t\tImageCopyright = ImageDetails[2];\n\t\t\t\t}\n\t\t\t\tconst ImageDate = new Date(parseInt(Image.startdate.substring(0,4)), parseInt(Image.startdate.substring(4,6)), parseInt(Image.startdate.substring(6,8)));\n\t\t\t\tif (Array.isArray(BingPictureList)){\n\t\t\t\t\tBingPictureList.push( {bingurl: \"https://bing.com\" + Image.url, url: \"\", path: \"\", info1: Image.title, info2: ImageDescription, info3: ImageCopyright, date: ImageDate} );\n\t\t\t\t} else{\n\t\t\t\t\tBingPictureList = [ {bingurl: \"https://bing.com\" + Image.url, url: \"\", path: \"\", info1: Image.title, info2: ImageDescription, info3: ImageCopyright, date: ImageDate} ];\n\t\t\t\t}\n\t\t\t});\n\t\t\tHelper.ReportingInfo(\"Debug\", \"Bing\", `Picture List from Bing: ${JSON.stringify(BingPictureList)}`,{JSON: JSON.stringify(BingPictureList.slice(0,10))});\n\t\t} catch (err) {\n\t\t\tHelper.ReportingError(err as Error, \"Unknown Error\", \"Bing\", \"updatePictureList/List\");\n\t\t\treturn { success: false, picturecount: 0};\n\t\t}\n\t\t// Saving list to files\n\t\ttry{\n\t\t\tfor (const CountElement in BingPictureList){\n\t\t\t\tconst currentWebCall = await axios.get(BingPictureList[CountElement].bingurl,{responseType: \"arraybuffer\"});\n\t\t\t\tawait Helper.Adapter.writeFileAsync(Helper.Adapter.namespace, `bing/${CountElement}.jpg`, currentWebCall.data);\n\t\t\t\tBingPictureList[CountElement].url = `/${Helper.Adapter.namespace}/bing/${CountElement}.jpg`;\n\t\t\t\tBingPictureList[CountElement].path = BingPictureList[CountElement].url;\n\t\t\t}\n\t\t\tHelper.ReportingInfo(\"Info\", \"Bing\", `${BingPictureList.length} pictures downloaded from Bing`, {JSON: JSON.stringify(BingPictureList.slice(0, 10))} );\n\t\t\treturn { success: true, picturecount: BingPictureList.length};\n\t\t} catch (err){\n\t\t\tHelper.ReportingError(err as Error, \"Unknown Error\", \"Bing\", \"updatePictureList/Download\");\n\t\t\treturn { success: false, picturecount: 0};\n\t\t}\n\t} else{\n\t\treturn { success: false, picturecount: 0};\n\t}\n}"],
  "mappings": "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",
  "names": ["axios"]
}
